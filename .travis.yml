language: go
go:
  - 1.12.x
services:
  - docker

before_install:
  - env GO111MODULE=on go get github.com/mattn/goveralls

  # Lock linter version to env: $GOLANGCI_LINT_VERSION
  - curl -sfL https://install.goreleaser.com/github.com/golangci/golangci-lint.sh | sh -s -- -b $(go env GOPATH)/bin ${GOLANGCI_LINT_VERSION-v1.17.1}
  - env GO111MODULE=on $GOPATH/bin/golangci-lint --version

script:
  - env GO111MODULE=on $GOPATH/bin/golangci-lint run
  - env GO111MODULE=on $GOPATH/bin/goveralls -service=travis-ci

after_success:
  # Required for docker push
  - test -n "$TRAVIS_TAG" && docker login -u="$DOCKER_USER" -p="$DOCKER_PASSWORD"

deploy:
# Goreleaser deployment
- provider: script
  skip_cleanup: true
  script: curl -sL https://git.io/goreleaser | bash
  on:
    tags: true
    condition: $TRAVIS_OS_NAME = linux